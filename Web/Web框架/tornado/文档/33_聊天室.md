#### 服务器端 ####

```
#coding=utf-8

import tornado.web
import tornado.ioloop
from tornado.websocket import WebSocketHandler

users=set()
class EchoWebSocket(WebSocketHandler):
    def open(self):
        users.add(self)
        [u.write_message(u"游客" + self.request.remote_ip + u"进来了" ) for u in users]
        
        
    def on_message(self, message):
        [u.write_message(u"游客"+self.request.remote_ip+u"说: " + message) for u in users]
       
    def on_close(self):
        users.remove(self)
        [u.write_message(u"游客" + self.request.remote_ip+u"退出了") for u in users]
        

    def check_origin(self, origin):
        # 检查是否同源，全部都是同源
        # 允许跨域请求
        return True

    def on_pong(self, data):
        print data, 'on_pong'

class ChatHandler(tornado.web.RequestHandler):
    def get(self, *args, **kwargs):
        self.render('chat.html')

import os
app = tornado.web.Application([
    (r'/chat',ChatHandler),
    (r'/socket',EchoWebSocket),
],template_path=os.path.join(os.getcwd(),'templates'),websocket_ping_interval =1)

app.listen(8888)

tornado.ioloop.IOLoop.instance().start()



```



#### 客户端 ####


```

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.9.0/jquery.min.js"></script>

    <style>

        .txt{
            width: 500px;
            height: 300px;
            background-color: blanchedalmond;
            overflow: scroll;
        }

        input[name='content']{
            font-size:20px;
            height:40px;
            width: 450px;
        }
        input[type='button']{
            height: 43px;
            width: 100px;
        }



    </style>

</head>
<body>
    <div class="txt"></div>
    <input type="text" name="content"/><input type="button" onclick="send()" value="发送消息"/>

    <script>
            var ws = new WebSocket("ws://192.168.1.128:8888/socket");
            ws.onopen = function() {
               console.log('连接成功！~')
            };
            ws.onmessage = function (evt) {
               $('.txt').append('<p>'+evt.data+'</p>')
            };
            ws.onclose =function(){
                console.log('关闭连接了~')
            }

            function send(){
                var c = $('input[name="content"]').val()
                ws.send(c)
                $('input[name="content"]').val("")
            }

    </script>
</body>
</html>
```